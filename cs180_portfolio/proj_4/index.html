<!DOCTYPE html>
<html>
<head>
    <title>CS 180 Project 3: Face Morphing and Modelling a Photo Collection</title>
    <script id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: antiquewhite;
        }

        header {
            background-color: #6dc070;
            color: white;
            padding: 20px;
            text-align: center;
        }

        section {
            padding: 20px;
        }

        img {
            width: 100%;
            max-width: 350px;
            height: auto;
            display: block;
            margin: 0 auto 20px;
        }

        /* Styling for the table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        table, th, td {
            border: 1px solid antiquewhite;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: none;
        }

        td img {
            max-width: 600px;
            height: auto;
        }
        figure {
            text-align: center; 
            margin: 0 auto; 
        }

    </style>
</head>
<body>
    <!-- Main Header -->
    <header>
        <h1>CS 180 Project 4A: Image Warping and Mosaicing</h1>
        <h2>Teja Kanthamneni</h2>
    </header>
    
    <section>
        <h2>Overview</h2>   
        <p> 
            This project furthers the exploration of image warping through computing homographies between images and blending them to create a mosaic. The resulting 
            image provides a greater perspective view than the original images. 
        </p>

        <h2>Capturing Images</h2>   
        <p> 
            Here are some of the images that I used for this project:
        </p> 

        <table class="center">
            <tr>
                <td>
                    <figure>
                        <img src=./assets/glade_1.jpg alt="teja_tri_mesh">
                        <figcaption>Glade Image 1</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/glade_2.jpg alt="suchir_tri_mesh">
                        <figcaption>Glade Image 2</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/doe1.jpg alt="teja_tri_mesh">
                        <figcaption>Campanile Image 1</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/doe2.jpg alt="suchir_tri_mesh">
                        <figcaption>Campanile Image 2</figcaption>
                    </figure>
                </td>
            </tr>
            <tr>
                <td>
                    <figure>
                        <img src=./assets/horizon1.jpg alt="teja_tri_mesh">
                        <figcaption>Horizon Image 1</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/horizon2.jpg alt="suchir_tri_mesh">
                        <figcaption>Horizon Image 2</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/foothill1.jpg alt="teja_tri_mesh">
                        <figcaption>Foothill Image 1</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/foothill2.jpg alt="suchir_tri_mesh">
                        <figcaption>Foothill Image 2</figcaption>
                    </figure>
                </td>
            </tr>
        </table>
        <table>
            <tr>
                <td>
                    <figure>
                        <img src=./assets/toyota.jpg alt="teja_tri_mesh">
                        <figcaption>Toyota Dealership</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/hallway.jpg alt="suchir_tri_mesh">
                        <figcaption>Apartment Hallway</figcaption>
                    </figure>
                </td>
            </tr>
        </table>
        
        <h2>Recovering Homographies</h2>
        
        <p>
            In order to recover the homographies between each of the images, I first manually defined correspondences for each pair of images. Here are the points 
            that were defined for some of the above images.
        </p>
        
        <table class="center">
            <tr>
                <td>
                    <figure>
                        <img src=./assets/corr_glade_1.jpg alt="teja_tri_mesh">
                        <figcaption>Glade Image 1 Correspondences</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/corr_glade_2.jpg alt="suchir_tri_mesh">
                        <figcaption>Glade Image 2 Correspondences</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/corr_doe_1.jpg alt="teja_tri_mesh">
                        <figcaption>Campanile Image 1 Correspondences</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/corr_doe_2.jpg alt="suchir_tri_mesh">
                        <figcaption>Campanile Image 2 Correspondences</figcaption>
                    </figure>
                </td>
            </tr>
            <tr>
                <td>
                    <figure>
                        <img src=./assets/corr_horizon_1.jpg alt="teja_tri_mesh">
                        <figcaption>Horizon Image 1 Correspondences</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/corr_horizon_2.jpg alt="suchir_tri_mesh">
                        <figcaption>Horizon Image 2 Correspondences</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/corr_foothill_1.jpg alt="teja_tri_mesh">
                        <figcaption>Foothill Image 1 Correspondences</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/corr_foothill_2.jpg alt="suchir_tri_mesh">
                        <figcaption>Foothill Image 2 Correspondences</figcaption>
                    </figure>
                </td>
            </tr>
        </table>

        <p>
            With these points, it is now possible to recover the projective transformation between the two images. This transformation will be of the following form:
        </p>
        <p>
            $$ \begin{bmatrix} a & b & c \\ d & e & f \\ g & h & 1 \end{bmatrix} \begin{bmatrix} x_1 \\ y_1 \\ 1 \end{bmatrix} = \begin{bmatrix} wx_2 \\ wy_2 \\ w \end{bmatrix}$$
        </p>
        <p>We can then rewrite this matrix-vecotr equation to solve for unknown values in the matrix:</p>

        <p>
            $$ \begin{bmatrix} x_1 & y_1 & 1 & 0 & 0 & 0 & -x_1x_2 & -y_1x_2 \\  0 & 0 & 0 & x_2 & y_2 & 1 & -x_1y_2 & -y_1y_2 \end{bmatrix} 
            \begin{bmatrix} a \\ b \\ c \\ d \\ e \\ f \\ g \\ h \end{bmatrix} = \begin{bmatrix} x_2 \\ y_2 \end{bmatrix}$$
        </p>

        <p>
            So from here, we can vetically/horizontally stack the values of our correspondence points into the matrix and result vector in the above system. Now notice we have an overconstrained system 
            and we can use Least Squares to solve. This is beneficial as it will work to minimize any noise introduced due to slightly inaccurate selection of correspondence points.
        </p>

        <h2>Image Rectification</h2>
        <p>
            One cool thing we can do with homographies is "rectify" images. Given an image and a known perspective we want to view it from, we can transform the image 
            to that perspective to "rectify" it. This was done capturing images with objects that are known to squares and then computing the the image and the coordinates 
            of a square with some side length \(d\): \([0, 0], [0, d], [d, d], [d, 0]\). This was performed on the image of the Toyota dealership and a image I took in 
            my apartmnet's hallway.
        </p>
        <table class="center">
            <tr>
                <td>
                    <figure>
                        <img src=./assets/toyota.png alt="teja_tri_mesh">
                        <figcaption>Toyota Dealership</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/toyota_rect.png alt="suchir_tri_mesh">
                        <figcaption>Toyota Dealership Rectified</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/hallway.png alt="teja_tri_mesh">
                        <figcaption>Hallway</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/hallway_rect.png alt="suchir_tri_mesh">
                        <figcaption>Hallway Rectified</figcaption>
                    </figure>
                </td>
            </tr>
        
        </table>

        <h2>Blending Images</h2>
        <p>
            After we've warped one image to the perspective of the other, the final step in creating our mosaic is to blend them. After expanding each image to include all 
            pixels in the bounding box of our final mosaic, I computed a distance transform, calculating the Euclidean distance from every pixel on the image to the closest 
            black backgorund pixel. Below are the visualizations of these distance transforms for the glade images:
        </p>

        <table>
            <tr>
                <td>
                    <figure>
                        <img src=./assets/dist_glade_1.jpg alt="teja_tri_mesh">
                        <figcaption>Glade Image 1 Distance Transform</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/dist_glade_2.jpg alt="suchir_tri_mesh">
                        <figcaption>Glade Image 2 Distance Transform</figcaption>
                    </figure>
                </td>
            </tr>
        </table>

        <p>
            These transforms were used to create masks that would be used to the blend the images. The blending technique used was two-band blending, where a two-level 
            Laplacian stack was created and each frequecy level was blended independently. Some of the mosaics still have some artifcats where you can see that it is a 
            stitching of two images. This was due to my iPhone camera changing the relative brightness in the iamges as it was rotated. Ideally, this brightness change 
            would not have been present, but ultimately it did not affect the quality of the images too much.
            Below are the final results of the blending:
        </p>

        <table>
            <tr>
                <td>
                    <figure>
                        <img src=./assets/glade_pano.jpg alt="teja_tri_mesh">
                        <figcaption>Glade Mosaic</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/doe_pano.jpg alt="suchir_tri_mesh">
                        <figcaption>Campanile Mosaic</figcaption>
                    </figure>
                </td>
            </tr>
            <tr>
                <td>
                    <figure>
                        <img src=./assets/horizon_pano.jpg alt="teja_tri_mesh">
                        <figcaption>Horizon Mosaic</figcaption>
                    </figure>
                </td>
                <td>
                    <figure>
                        <img src=./assets/foothill_pano.jpg alt="suchir_tri_mesh">
                        <figcaption>Foothill Mosaic</figcaption>
                    </figure>
                </td>
            </tr>
        </table>

</body>
</html>